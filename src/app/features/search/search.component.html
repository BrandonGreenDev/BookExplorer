<mat-toolbar color="primary">
  <span>Book Explorer</span>
  <span class="spacer"></span>
  <button
    mat-icon-button
    (click)="themeService.toggleTheme()"
    [matTooltip]="themeService.isDarkMode() ? 'Switch to light mode' : 'Switch to dark mode'"
    aria-label="Toggle theme"
  >
    <mat-icon>{{ themeService.isDarkMode() ? 'light_mode' : 'dark_mode' }}</mat-icon>
  </button>
</mat-toolbar>

<div class="search-container page-content">
  <div class="search-section">
    <mat-form-field class="search-field" appearance="outline">
      <mat-label>Search for books</mat-label>
      <input
        matInput
        type="text"
        placeholder="Enter book title, author, genre, or keyword..."
        [formControl]="searchControl"
      />
    </mat-form-field>
  </div>

  <div class="filters-section" [formGroup]="filterForm">
    <h3 class="filters-title">
      <mat-icon>filter_list</mat-icon>
      Filters
    </h3>

    <div class="filters-grid">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Author Name</mat-label>
        <input
          matInput
          type="text"
          formControlName="author"
          placeholder="e.g., Tolkien"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Publication Year</mat-label>
        <input
          matInput
          type="number"
          formControlName="year"
          placeholder="e.g., 2020"
          [min]="1000"
          [max]="currentYear"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Subject/Genre</mat-label>
        <mat-select formControlName="subject">
          <mat-option value="">All Subjects</mat-option>
          <mat-option *ngFor="let subject of subjects" [value]="subject">
            {{ subject }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <button
      mat-raised-button
      color="accent"
      class="clear-button"
      (click)="clearFilters()"
    >
      <mat-icon>clear</mat-icon>
      Clear Filters
    </button>
  </div>

  <div class="results-section">
    <!-- Results count -->
    <div class="results-info" *ngIf="!isLoading && books.length > 0">
      <p>Showing {{ books.length }} of {{ totalResults | number }} results</p>
    </div>

    <!-- Initial loading -->
    <div class="loading-container" *ngIf="isLoading">
      <mat-spinner></mat-spinner>
      <p>Searching for books...</p>
    </div>

    <!-- No results -->
    <div class="no-results" *ngIf="!isLoading && books.length === 0">
      <mat-icon>search_off</mat-icon>
      <p>No books found. Try a different search or adjust your filters.</p>
    </div>

    <!-- Books grid -->
    <div class="books-grid" *ngIf="!isLoading && books.length > 0">
      <app-book-card
        *ngFor="let book of books"
        [book]="book"
        (bookClick)="onBookClick($event)"
      ></app-book-card>

      <!-- Scroll trigger for infinite scroll (inside grid to ensure it's rendered) -->
      <div #scrollTrigger class="scroll-trigger"></div>
    </div>

    <!-- Loading more indicator -->
    <div class="loading-more" *ngIf="isLoadingMore">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading more books...</p>
    </div>

    <!-- End of results message -->
    <div class="end-of-results" *ngIf="!hasMoreResults && books.length > 0">
      <mat-icon>check_circle</mat-icon>
      <p>You've reached the end of the results</p>
    </div>
  </div>
</div>
